<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>夺宝系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            font-family: '微软雅黑', Arial;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        .lottery-container {
            width: 600px;
            margin: 50px auto;
            text-align: center;
        }
        .prize-track {
            display: flex;
            justify-content: center;
            margin: 40px 0;
            position: relative;
            height: 120px;
        }
        .prize-item {
            width: 150px;
            height: 100px;
            margin: 0 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .prize-item[data-prize="thanks"] { color: #808080; border: 2px solid #808080; }
        .prize-item[data-prize="projector"] { color: #FFD700; border: 2px solid #FFD700; }
        
        .selector {
            position: absolute;
            width: 180px;
            height: 120px;
            border: 3px solid gold;
            border-radius: 15px;
            box-shadow: 0 0 25px gold;
            top: 50%;
            left: -100px;
            transform: translateY(-50%);
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s, left 0.1s linear;
        }
        .selector.visible {
            opacity: 1;
        }
        .result-box {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            text-align: center;
            font-size: 1.5em;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .spin-btn {
            margin-top: 30px;
            padding: 12px 40px;
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            color: #fff;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255,75,43,0.4);
            transition: all 0.3s;
        }
        .spin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255,75,43,0.6);
        }
        .spin-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .counter {
            margin-top: 20px;
            color: #FFD700;
            font-size: 1.1em;
        }
        /* 弹窗样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-content {
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }
        .modal.show {
            opacity: 1;
            pointer-events: auto;
        }
        .modal.show .modal-content {
            transform: translateY(0);
        }
        .modal h2 {
            color: #FFD700;
            margin-bottom: 20px;
        }
        .modal p {
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .modal-btn {
            padding: 8px 25px;
            background: #FF4757;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        .modal-btn:hover {
            background: #ff6b81;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="lottery-container">
        <h1 style="color: #FFD700; margin-bottom: 30px;">✨ 夺宝系统 ✨</h1>
        
        <div class="prize-track">
            <div class="prize-item" data-prize="thanks">谢谢惠顾</div>
            <div class="prize-item" data-prize="projector">投影仪</div>
            <div class="selector" id="selector"></div>
        </div>
        
        <button class="spin-btn" id="spinBtn">立即抽奖</button>
        <div class="counter">剩余抽奖次数: <span id="count">3</span></div>
        
        <div id="result" class="result-box">
            <span id="resultText">点击抽奖按钮开始游戏</span>
        </div>
    </div>

    <!-- 弹窗 -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 id="modalTitle">标题</h2>
            <p id="modalMessage">消息内容</p>
            <button class="modal-btn" id="modalBtn">确定</button>
        </div>
    </div>

    <script>
        // 奖品配置
        const prizes = {
            thanks: { 
                name: '谢谢惠顾', 
                color: '#808080',
                modal: {
                    title: '很遗憾',
                    message: '没有抽到奖品'
                }
            },
            projector: { 
                name: '投影仪', 
                color: '#FFD700',
                modal: {
                    title: '恭喜你',
                    message: '抽中了投影仪！'
                }
            }
        };

        // 固定抽奖顺序（3次）
        const prizeSequence = ['thanks', 'thanks', 'projector'];

        const selector = document.getElementById('selector');
        const spinBtn = document.getElementById('spinBtn');
        const resultText = document.getElementById('resultText');
        const countDisplay = document.getElementById('count');
        const prizeItems = document.querySelectorAll('.prize-item');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalBtn = document.getElementById('modalBtn');
        
        const itemWidth = 150 + 30; // 宽度 + 外边距
        let currentRound = 0;
        let remainingAttempts = 3;
        let isAnimating = false;
        let animationId = null;
        
        // 初始化
        spinBtn.addEventListener('click', startLottery);
        modalBtn.addEventListener('click', () => modal.classList.remove('show'));
        
        function startLottery() {
            if (isAnimating || remainingAttempts <= 0) return;
            
            isAnimating = true;
            spinBtn.disabled = true;
            
            // 获取当前轮次的奖品ID
            const prizeId = prizeSequence[currentRound];
            const targetIndex = Array.from(prizeItems)
                .findIndex(item => item.dataset.prize === prizeId);
            
            // 开始动画
            animateSelection(targetIndex, prizeId);
        }
        
        function animateSelection(targetIndex, prizeId) {
            const startTime = performance.now();
            const duration = 3000; // 动画时长3秒
            const spins = 4; // 虚拟旋转圈数
            
            // 计算每个奖品的位置
            const itemPositions = Array.from(prizeItems).map((item, index) => {
                const rect = item.getBoundingClientRect();
                const trackRect = item.parentElement.getBoundingClientRect();
                return rect.left - trackRect.left + rect.width/2;
            });
            
            // 计算总移动距离（虚拟圈数 + 目标位置）
            const totalItems = prizeItems.length;
            const totalSteps = spins * totalItems + targetIndex;
            
            // 显示选择器并重置位置
            selector.classList.add('visible');
            selector.style.left = '-100px';
            
            const animate = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // 使用缓动函数实现先快后慢
                const easeProgress = easeOutCubic(progress);
                const currentStep = Math.floor(easeProgress * totalSteps);
                const currentIndex = currentStep % totalItems;
                
                // 更新选择器位置
                selector.style.left = `${itemPositions[currentIndex]}px`;
                
                // 最后阶段精确对齐目标
                if (progress > 0.9) {
                    selector.style.left = `${itemPositions[targetIndex]}px`;
                }
                
                if (progress < 1) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    finishAnimation(targetIndex, prizeId);
                }
            };
            
            animationId = requestAnimationFrame(animate);
        }
        
        function finishAnimation(targetIndex, prizeId) {
            // 隐藏选择器
            selector.classList.remove('visible');
            
            // 标记已获得的奖品
            prizeItems[targetIndex].classList.add('claimed');
            
            // 获取当前奖品信息
            const prize = prizes[prizeId];
            
            // 显示结果
            resultText.textContent = `获得：${prize.name}`;
            resultText.style.color = prize.color;
            
            // 显示弹窗
            showModal(prize.modal.title, prize.modal.message);
            
            // 更新状态
            currentRound++;
            remainingAttempts--;
            countDisplay.textContent = remainingAttempts;
            isAnimating = false;
            
            if (remainingAttempts <= 0) {
                spinBtn.disabled = true;
                spinBtn.textContent = '抽奖结束';
            } else {
                spinBtn.disabled = false;
            }
            
            cancelAnimationFrame(animationId);
        }
        
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.add('show');
        }
        
        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }
    </script>
</body>
</html>
